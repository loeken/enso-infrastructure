# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# ...

source /etc/network/interfaces.d/*

auto lo
iface lo inet loopback

{% set primary_interface = ansible_facts.default_ipv4.interface %}
{% set bridge_index = 0 %}

{% for interface in ansible_facts.interfaces %}
{% if interface.startswith('enp') %}

# Interface {{ interface }}
auto {{ interface }}
iface {{ interface }} inet manual

# Bridge for interface {{ interface }}
auto vmbr{{ bridge_index }}
iface vmbr{{ bridge_index }} inet {% if bridge_index == 0 %}static{% else %}manual{% endif %}
    {% if bridge_index == 0 %}
    address {{ ansible_facts.default_ipv4.address }}
    netmask {{ ansible_facts.default_ipv4.netmask }}
    gateway {{ ansible_facts.default_ipv4.gateway }}
    {% endif %}
    bridge-ports {{ interface }}
    bridge-stp off
    bridge-fd 0
    bridge-vlan-aware yes
    bridge-vids 2-4094

{% set bridge_index = bridge_index + 1 %}
{% endif %}
{% endfor %}
